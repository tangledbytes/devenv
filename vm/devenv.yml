vmType: qemu
images:
- location: "https://download.fedoraproject.org/pub/fedora/linux/releases/38/Cloud/x86_64/images/Fedora-Cloud-Base-38-1.6.x86_64.qcow2"
  arch: "x86_64"
  digest: "sha256:d334670401ff3d5b4129fcc662cf64f5a6e568228af59076cc449a4945318482"
- location: "https://download.fedoraproject.org/pub/fedora/linux/releases/38/Cloud/aarch64/images/Fedora-Cloud-Base-38-1.6.aarch64.qcow2"
  arch: "aarch64"
  digest: "sha256:ad71d22104a16e4f9efa93e61e8c7bce28de693f59c802586abbe85e9db55a65"

cpus: null
memory: null
disk: null

mounts:
  - location: "#{{HOME}}/dev"
    mountPoint: "/home/#{{USER}}.linux/dev"
    writable: true
  - location: "/tmp/lima"
    writable: true
mountType: 9p

ssh:
  localPort: 2322

containerd:
  system: false
  user: false

provision:
  - mode: system
    script: |
      #!/bin/bash
      # SETUP SYSTEM
      set -eux -o pipefail

      # Install and setup required programs
      dnf update -y
      dnf groupinstall -y "Development Tools" "Development Libraries"
      dnf install -y vim stow tmux git fzf ripgrep zsh sqlite3 fd-find ninja-build gettext cmake unzip curl util-linux-user
  - mode: user
    script: |
      #!/bin/bash
      # SETUP ZSH
      set -eux -o pipefail

      # Make ZSH default shell for this user
      sudo chsh -s $(which zsh) $(whoami)

      # Prepare the home directory
      sudo rm -rf ~/.zshrc
      sudo chown $(whoami): ~
      mkdir -p ~/bin
      mkdir -p ~/.local/share

      # Setup the dotfiles if the ~/dev/dotfiles directory exists
      echo "Setting up dotfiles"
      if [[ -d ~/dev/dotfiles ]]; then
        # Create a copy of dotfiles so that symlinking doesn't break anything on host
        cp -r ~/dev/dotfiles ~/.dotfiles
      fi
      pushd ~/.dotfiles
      make setup
      popd

      # Install starship 
      curl -fsSL https://starship.rs/install.sh | sh -s -- -y

